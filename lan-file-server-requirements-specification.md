# LAN文件服务器需求规格说明书

## 文档信息

|项|内容|
|---|---|
|文档版本|V3.0|
|编制日期|2025-12-30|
|适用范围|LAN文件服务器（本地多媒体文件共享）|
|核心目标|轻量、美观、安全的本地多媒体文件共享服务器，支持全局护眼模式与精准索引|
|状态|✅ 已完成开发并部署运行（根据实际代码实现修正）|

## 一、文档概述

### 1.1 文档目的

明确LAN文件服务器的功能、界面、技术等核心需求，作为开发、测试、验收的唯一依据。

### 1.2 项目范围

- 核心：共享指定目录下的多媒体文件，提供索引/目录浏览功能
- 边界：仅支持白名单内的多媒体文件，不处理其他类型文件；仅局域网内访问，不对外暴露

## 二、项目背景

用户需要一款轻量级LAN文件服务器，用于在局域网内共享指定目录下的多媒体文件（图片、音频、视频），要求：

1. 界面美观简洁，支持全局护眼（夜间）模式；

2. 索引功能仅覆盖指定白名单多媒体文件及文件夹，其余文件不显示；

3. 所有页面（索引、目录、认证、报错）统一风格，操作简单；

4. 支持基础的身份认证，防止未授权访问。

## 三、核心需求

1. **功能核心**：仅索引/展示指定白名单多媒体文件+文件夹，其余文件不参与；

2. **体验核心**：全局护眼模式（所有页面生效、本地记忆、平滑过渡）；

3. **界面核心**：美观、简洁、大方，响应式适配（PC/移动端）；

4. **安全核心**：基础身份认证，防暴力破解；

5. **易用核心**：操作无学习成本，索引支持搜索、目录支持导航。

## 四、详细功能需求

### 4.1 服务器基础功能

|功能点|详细需求|实现状态|
|---|---|---|
|目录配置|支持配置共享根目录，所有功能仅针对该目录下的文件/文件夹生效|✅ 已实现|
|白名单文件过滤|仅处理以下类型文件，其余文件不显示/不索引：<br/>- 图片：.jpg/.jpeg/.png/.gif/.bmp/.webp/.svg<br/>- 音频：.wav/.mp3/.ogg/.wma/.m4a/.flac<br/>- 视频：.mp4/.mov/.avi/.flv/.mkv/.wmv/.mpeg/.mpg/.webm|✅ 已实现（20种文件类型）|
|端口配置|固定端口8000，支持局域网访问|✅ 已实现|
|文件大小格式化|展示文件大小（B/KB/MB/GB/TB），格式友好（如1.25 MB）|✅ 已实现|
|跨平台兼容|支持Windows系统（核心），兼容Python 3.7+版本|✅ 已实现|
### 4.2 全局护眼（夜间）模式

|功能点|详细需求|实现状态|
|---|---|---|
|全页面覆盖|索引页、目录列表页、认证页、404报错页均支持护眼模式切换|✅ 已实现|
|模式记忆|切换模式后通过localStorage保存状态，页面刷新/跳转后自动恢复当前模式|✅ 已实现|
|平滑过渡|模式切换时，所有样式（背景、文字、边框等）0.3秒平滑过渡，无闪烁/卡顿|✅ 已实现|
|切换按钮|所有页面统一显示模式切换按钮（☀️白天/🌙黑夜），位置统一（页面顶部右侧）|✅ 已实现|
|配色规范|- 白天模式：白底黑字，浅色系边框/按钮<br/>- 夜间模式：深灰底浅灰字，低对比度护眼配色|✅ 已实现|
### 4.3 索引功能（核心）

|功能点|详细需求|实现状态|
|---|---|---|
|索引范围|仅包含配置共享目录下的：<br/>1. 所有文件夹（无论是否包含白名单文件）<br/>2. 所有白名单内的多媒体文件|✅ 已实现|
|索引结构|按目录层级递归展示，支持目录导航|✅ 已实现|
|搜索功能|支持模糊搜索文件名/文件夹名，点击搜索按钮触发，无匹配时显示"未找到匹配内容"|✅ 已实现|
|索引展示项|- 文件夹：📁 图标+名称+跳转链接<br/>- 文件：🖼️/🎵/🎬/📄 图标+名称+大小+下载/播放链接|✅ 已实现|
|界面布局|搜索框置顶，索引列表居中展示，整体布局简洁，无冗余元素|✅ 已实现|
### 4.4 目录列表功能

|功能点|详细需求|实现状态|
|---|---|---|
|目录导航|显示当前目录路径，提供"返回上一层"按钮，根目录返回索引页|✅ 已实现|
|面包屑导航|显示当前路径：首页 / 文件夹1 / 文件夹2|✅ 已实现|
|列表展示|- 文件夹：📁 图标+名称+跳转链接（优先展示）<br/>- 文件：�️/🎵/🎬/�📄 图标+名称+大小+下载链接|✅ 已实现|
|排序规则|文件夹在前、文件在后，均按名称小写字母升序排序|✅ 已实现|
|响应式适配|移动端下"返回上一层"按钮与模式切换按钮自动堆叠，不挤压布局|✅ 已实现|
### 4.5 认证与安全功能

|功能点|详细需求|实现状态|
|---|---|---|
|身份认证|访问任何页面/接口前需验证用户名密码，未认证跳转认证页|✅ 已实现（配置文件中设置）|
|密码安全存储|密码通过PBKDF2-HMAC-SHA256哈希+盐值存储，无明文保存|✅ 已实现|
|防暴力破解|连续5次认证失败后，IP临时封禁5分钟（可配置）|✅ 已实现|
|认证页设计|简洁的用户名/密码输入框，适配护眼模式，提示信息友好|✅ 已实现|
### 4.6 错误处理功能

|功能点|详细需求|实现状态|
|---|---|---|
|404错误页|资源不存在时展示友好404页面，支持护眼模式，提供"返回首页"链接|✅ 已实现|
|认证错误页|用户名/密码错误时，提示剩余尝试次数，适配护眼模式|✅ 已实现|
|配置错误处理|配置文件缺失/错误时，生成默认配置并提示用户，不直接崩溃|✅ 已实现|
|错误处理功能|所有页面统一风格，操作简单，提示信息友好，适配护眼模式|✅ 已实现|
|配置灵活性|支持完整的配置文件管理，包括日志、主题、缓存等高级配置|✅ 已实现|

## 五、界面设计要求

### 5.1 整体风格

- **核心原则**：简洁、大方、无冗余，突出文件/文件夹信息，弱化装饰性元素；

- **配色**：仅保留护眼模式的两套配色，无多余色彩；

- **字体**：使用系统默认无衬线字体（如Arial、微软雅黑），大小适中（PC端14px，移动端自适应）；

- **布局**：所有页面统一头部（标题+模式切换按钮），内容区居中，底部极简（仅版权/提示文字）。

### 5.2 页面布局

#### 5.2.1 标题与导航区域
```
[LAN文件服务器标题 - 居中]  [主题切换按钮]
```

#### 5.2.2 搜索区域
```
[搜索框 - 占位符：搜索文件或文件夹...] [搜索按钮]
```

#### 5.2.3 文件列表区域
```
📁 文件夹 (数量)
  - 📁 文件夹1
  - 📁 文件夹2

📄 文件 (数量)
  - 🖼️ filename.jpg (1.25 MB)
  - 🎵 audio.mp3 (3.5 MB)
  - 🎬 video.mp4 (125.8 MB)
```

#### 5.2.4 路径导航
```
首页 / 文件夹1 / 文件夹2 [⬅️ 返回上一层]
```

### 5.3 响应式布局

|设备类型|文件列表宽度|特殊布局|
|---|---|---|
|PC端（≥768px）|页面宽度的50%左右|搜索框与文件列表垂直排列|
|移动端（<768px）|占满屏幕宽度|所有元素垂直排列，按钮堆叠|

### 5.4 交互细节

- 文件夹点击：直接跳转到子目录；

- 文件点击：下载或播放文件；

- 搜索功能：输入内容后点击搜索按钮触发实时过滤；

- 主题切换：点击按钮即时生效，按钮文字/图标同步切换；

- 返回导航：点击返回按钮回到上级目录，根目录返回索引页。

## 六、技术实现

### 6.1 开发语言与框架

- 后端：Python 3.7+，使用Python原生http.server + BaseHTTPRequestHandler；

- 前端：原生HTML/CSS/JS（无框架），保证轻量、兼容性；

- 配置文件：使用Python ConfigParser模块，支持INI格式。

### 6.2 核心技术点

- 护眼模式：CSS变量+localStorage+JavaScript DOM操作；

- 文件索引：递归遍历目录，过滤白名单文件；

- 身份认证：HTTP Basic Auth+PBKDF2哈希+自定义会话管理；

- 服务器：基于Python原生http.server，支持多线程并发；

### 6.3 文件结构

```
lan-file-server/
├── server.py                        # 主服务器文件
├── config.py                        # 配置管理
├── static/
│   └── style.css                   # 样式文件
├── 启动LAN文件服务器.bat            # Windows批处理启动脚本
├── 启动LAN文件服务器.ps1           # PowerShell启动脚本
├── 创建桌面快捷方式.ps1            # 桌面快捷方式创建脚本
├── README.md                       # 项目说明文档
├── LAN文件服务器需求规格说明书.md   # 技术需求文档
├── 用户需求规格说明书.md           # 用户需求文档
├── PROJECT_TIMELINE.md            # 项目时间线
├── project_timeline.txt           # 项目时间线文本版
├── LICENSE                        # 许可证文件
└── .gitignore                     # Git忽略文件
```

### 6.4 白名单文件类型

当前支持17种文件类型：

**图片格式（6种）**：.jpg, .jpeg, .png, .gif, .bmp, .webp

**音频格式（6种）**：.wav, .mp3, .ogg, .wma, .m4a, .flac

**视频格式（8种）**：.mp4, .mov, .avi, .flv, .mkv, .wmv, .mpeg, .mpg

## 七、配置要求

### 7.1 服务器配置（server_config.ini）

#### [SERVER] 节配置

|配置项|默认值|说明|
|---|---|---|
|PORT|8000|服务器端口|
|MAX_CONCURRENT_THREADS|10|最大并发线程数|
|SHARE_DIR|D:\SteamLibrary\steamapps\workshop\content\431960|共享根目录|
|SSL_CERT_FILE|空|SSL证书文件路径|
|SSL_KEY_FILE|空|SSL私钥文件路径|
|FAILED_AUTH_LIMIT|5|认证失败最大次数|
|FAILED_AUTH_BLOCK_TIME|300|封禁时间（秒）|

#### [LOGGING] 节配置

|配置项|默认值|说明|
|---|---|---|
|log_level|INFO|日志级别（DEBUG/INFO/WARNING/ERROR）|
|log_file|lan_file_server.log|日志文件路径|

#### [THEME] 节配置

|配置项|默认值|说明|
|---|---|---|
|default_theme|light|默认主题（light/dark）|

#### [CACHING] 节配置

|配置项|默认值|说明|
|---|---|---|
|index_cache_size|1000|索引缓存大小|
|search_cache_size|500|搜索缓存大小|
|update_interval|300|缓存更新间隔（秒）|

### 7.2 认证配置（auth_config.ini）

|配置项|值|说明|
|---|---|---|
|username|*|认证用户名（在auth_config.ini中配置）|
|password_hash|*|密码哈希值（PBKDF2）|
|salt|*|盐值|
|failed_auth_limit|5|认证失败限制|
|failed_auth_block_time|300|封禁时间（秒）|

## 八、非功能需求

### 8.1 性能要求

- 索引生成：1000个以内文件/文件夹，生成时间≤1秒；

- 并发访问：支持10个以内客户端同时访问，无卡顿；

- 响应速度：页面加载≤200ms，API请求响应≤500ms。

### 8.2 易用性要求

- 部署：解压后运行Python文件即可启动；

- 配置：提供默认配置，无需复杂设置；

- 操作：所有功能仅需点击/输入，无专业知识要求。

### 8.3 安全性要求

- 无明文存储：密码仅存储哈希值，无日志记录；

- 路径安全：禁止访问共享目录外的文件；

- 防暴力破解：IP封禁机制，防止密码猜测。

### 8.4 可维护性要求

- 代码结构清晰，分模块（配置/工具/服务器）；

- 关键函数添加注释，配置文件有默认值；

- 错误日志清晰，便于定位问题。

## 九、验收标准

### 9.1 功能验收

1. ✅ 服务器启动：无报错，自动适配端口，控制台输出访问地址；

2. ✅ 护眼模式：所有页面切换生效，刷新后记忆状态，过渡平滑；

3. ✅ 索引功能：仅显示白名单文件+文件夹，搜索实时过滤，导航正常；

4. ✅ 目录列表：导航正常，文件/文件夹排序正确，下载链接可用；

5. ✅ 认证功能：未认证跳转认证页，密码错误封禁，哈希存储无明文；

6. ✅ 界面：所有页面美观简洁，移动端适配正常，无冗余元素。

### 9.2 界面验收

1. ✅ 标题区域：页面顶部居中显示"LAN文件服务器"标题；

2. ✅ 搜索区域：标题下方显示搜索框和搜索按钮；

3. ✅ 文件列表：搜索框下方显示文件夹和文件分组；

4. ✅ 导航功能：显示面包屑导航和返回按钮；

5. ✅ 主题切换：页面右上角显示主题切换按钮；

6. ✅ 响应式：PC端和移动端布局适配正确。

### 9.3 兼容性验收

1. ✅ 浏览器：Chrome、Edge、Firefox浏览器访问正常；

2. ✅ 设备：Windows 10/11系统运行稳定；

3. ✅ 分辨率：适配1080P、720P、移动端（320px+）。

## 十、部署信息

### 10.1 运行环境

- 操作系统：Windows 10/11

- Python版本：Python 3.7+

- 依赖库：Flask（唯一外部依赖）

### 10.2 启动方式

#### 方式1：直接运行
```bash
cd lan-file-server
python server.py
```

#### 方式2：使用Windows批处理脚本
```bash
启动LAN文件服务器.bat
```

#### 方式3：使用PowerShell脚本
```powershell
.\启动LAN文件服务器.ps1
```

### 10.3 访问地址

- 本地访问：http://localhost:8000

- 局域网访问：http://[本机IP]:8000

### 10.4 默认账号

- 用户名和密码在 auth_config.ini 配置文件中设置
- 首次运行时会提示设置认证凭据

## 十一、当前状态

✅ **项目已完成开发并成功部署运行**

所有核心功能已实现并通过测试：
- 身份认证系统正常工作
- 文件索引和搜索功能正常
- 主题切换和响应式布局正常
- 文件下载功能正常
- 错误处理和日志记录正常

项目已达到所有预期目标，可以正式投入使用。

---

**文档版本历史**

|版本|日期|修改内容|
|---|---|---|
|V1.0|2025-12-29|初始版本|
|V2.0|2025-12-29|根据最终实现成果更新需求规格说明书|
|V2.1|2025-12-29|更新配置部分，新增LOGGING、THEME、CACHING配置节及相关参数|
|V3.0|2025-12-30|根据实际代码实现修正：更正技术架构为Python原生http.server，修正文件类型支持数量，更新启动方式说明，完善项目结构|

> （注：此文档反映了项目的最终实现状态，所有功能均已验证通过）